# 旅遊音檔系統 (Travel Audio App)

本專案實作 **旅遊音檔管理系統**，提供 API 取用、快取、資料庫存取與檔案下載功能，並結合狀態管理與播放器操作。

---

## 📦 專案架構

### 抽象類別 (Repository Interface)

- 定義主要 **資料倉儲介面**
- 提供取得「旅遊音檔」的方法
- 透過 **成功 / 失敗回呼** 傳遞結果
    - **成功**：回傳 `TravelAudioList`
    - **失敗**：回傳錯誤代碼與訊息

---

### 資料倉儲 (Repository)

- **Singleton 單例模式**
- 負責處理「旅遊音檔」的存取邏輯：
    - API 請求
    - 快取 (JSON)
    - **資料庫存取**
    - 檔案下載

#### 📑 功能

- 取得旅遊音檔清單（支援分頁）
- 建立新的 `TravelAudioList`
- 將 API 回傳的資料轉換成內部使用的 `TravelAudio`
- 分頁策略：
    - 第一頁 → 直接取代
    - 其他頁 → 合併舊清單

---

### 資料庫 (TravelAudioDatabase)

使用 **Drift** + SQLite 實作本地資料儲存。

#### ⚙️ 設定

- 預設使用 `travel_audio.db`
- `schemaVersion = 2`
- Migration 策略：
    - **v1 → v2**：新增 `filePath` 欄位

#### 📑 功能

- **新增或更新音檔**：
    - 若無舊資料 → 插入
    - 若有舊資料 → 依 `modified` 欄位比對，更新較新的版本
- **查詢全部音檔**
- **查詢單筆音檔 (by id)**

---

### 狀態管理器 (State Manager)

負責操作 **旅遊音檔清單**，包含：

- 初始化狀態
- 從 Repository 取得清單
- 下載單筆音檔
- 更新資料庫與狀態

#### ⬇️ 音檔下載

- 避免重複下載（`_isDownloading` 判斷）
- 下載指定索引音檔 MP3
- 提供下載進度回呼 `(已接收 / 總大小)`
- 下載完成後回傳檔案路徑

---

### 播放器狀態模型 (Player State)

- **travelAudio**：當前播放的音檔
- **isPlaying**：是否正在播放

#### ▶️ 播放流程

1. 停止目前播放
2. 讀取本地檔案
3. 更新播放狀態

#### ⏯️ 播放 / 暫停切換

- 若同一音檔：
    - 正在播放 → 暫停
    - 暫停中 → 播放
- 若不同音檔：目前不切換（可擴充）

